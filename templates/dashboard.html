{% extends "base.html" %}
{% block title %}ëŒ€ì‹œë³´ë“œ{% endblock %}
{% block content %}
<h2>ëŒ€ì‹œë³´ë“œ</h2>

<!-- ê²€ìƒ‰ í¼ -->
<form method="GET" action="{{ url_for('dashboard') }}">
    <label for="search">ìƒí’ˆ ê²€ìƒ‰:</label>
    <input type="text" id="search" name="search" value="{{ search_query }}" placeholder="ì œëª© ë˜ëŠ” ì„¤ëª…ìœ¼ë¡œ ê²€ìƒ‰">
    <button type="submit">ê²€ìƒ‰</button>
</form>

<h3>ë“±ë¡ëœ ìƒí’ˆ</h3>
{% if products %}
    <ul>
    {% for product in products %}
        <li>
            <a href="{{ url_for('view_product', product_id=product.id) }}">{{ product.title }}</a>
            - ê°€ê²©: {{ product.price }} (íŒë§¤ì: {{ product.seller_username }})
        </li>
    {% endfor %}
    </ul>
{% else %}
    <p>ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
{% endif %}
<p><a href="{{ url_for('new_product') }}">ìƒˆ ìƒí’ˆ ë“±ë¡</a></p>

<a href="{{ url_for('transfer') }}">ğŸ’¸ ì†¡ê¸ˆí•˜ê¸°</a>


<h3>ì‹¤ì‹œê°„ ì±„íŒ…</h3>
<div id="chat">
    <ul id="messages"></ul>
    <input id="chat_input" type="text" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    <button onclick="sendMessage()">ì „ì†¡</button>
</div>

<script type="text/javascript">
    var socket = io();
    socket.on('connect', function() {
        console.log("ì±„íŒ… ì„œë²„ì— ì—°ê²°ë¨");
    });
    socket.on('message', function(data) {
        var messages = document.getElementById('messages');
        var item = document.createElement('li');
        item.textContent = data.username + ": " + data.message;
        messages.appendChild(item);
        window.scrollTo(0, document.body.scrollHeight);
    });
    function sendMessage() {
        var input = document.getElementById('chat_input');
        var message = input.value;
        if (message) {
            socket.emit('send_message', { 'username': "{{ user.username }}", 'message': message });
            input.value = "";
        }
    }
</script>
{% endblock %}